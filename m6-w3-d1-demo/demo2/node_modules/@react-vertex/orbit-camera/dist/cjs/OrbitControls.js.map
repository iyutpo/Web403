{"version":3,"sources":["../../src/OrbitControls.ts"],"names":["OrbitControls","camera","element","dollyStep","dollyCurr","dragging","distance","x","y","lastX","lastY","rotationSpeed","onMouseUp","e","stopPropagation","preventDefault","onTouchEnd","onMouseDown","pageX","pageY","onTouchStart","touches","t1","t2","a","b","Math","sqrt","onMouseMove","dx","dy","rotate","onTouchMove","nextDistance","dolly","onMouseWheel","deltaY","max","position","value","width","height","incX","incY","incRotationY","incRotationX"],"mappings":"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","sourcesContent":["import { OrbitCamera } from './OrbitCamera'\n\nexport class OrbitControls {\n  camera: OrbitCamera\n  element: HTMLCanvasElement\n\n  dollyStep: number\n  dollyCurr: number\n\n  constructor(camera: OrbitCamera, element: HTMLCanvasElement) {\n    this.camera = camera\n    this.element = element\n\n    this.dollyStep =\n      Math.max(\n        this.camera.position[0],\n        this.camera.position[1],\n        this.camera.position[2],\n      ) / 100\n\n    this.dollyCurr = 0\n  }\n\n  dragging = false\n  distance: number | null = null\n\n  x = 0\n  y = 0\n\n  lastX = 0\n  lastY = 0\n\n  rotationSpeed = 1000\n\n  onMouseUp = (e: MouseEvent) => {\n    e.stopPropagation()\n    e.preventDefault()\n\n    this.dragging = false\n    this.distance = null\n  }\n\n  onTouchEnd = (e: TouchEvent) => {\n    e.stopPropagation()\n    e.preventDefault()\n\n    this.dragging = false\n    this.distance = null\n  }\n\n  onMouseDown = (e: MouseEvent) => {\n    this.dragging = true\n\n    e.stopPropagation()\n    e.preventDefault()\n\n    this.x = e.pageX\n    this.y = e.pageY\n  }\n\n  onTouchStart = (e: TouchEvent) => {\n    const [t1, t2] = e.touches\n\n    e.stopPropagation()\n    e.preventDefault()\n\n    if (t2) {\n      const a = t1.pageX - t2.pageX\n      const b = t1.pageY - t2.pageY\n      this.distance = Math.sqrt(a * a + b * b)\n    } else {\n      this.x = t1.pageX\n      this.y = t1.pageY\n      this.dragging = true\n    }\n  }\n\n  onMouseMove = (e: MouseEvent) => {\n    this.lastX = this.x\n    this.lastY = this.y\n\n    e.stopPropagation()\n    e.preventDefault()\n\n    this.x = e.pageX\n    this.y = e.pageY\n\n    if (!this.dragging) return\n\n    const dx = this.lastX - this.x\n    const dy = this.lastY - this.y\n\n    this.rotate(dx, dy)\n  }\n\n  onTouchMove = (e: TouchEvent) => {\n    const [t1, t2] = e.touches\n\n    e.stopPropagation()\n    e.preventDefault()\n\n    if (t2) {\n      if (!this.distance) {\n        return\n      }\n\n      const a = t1.pageX - t2.pageX\n      const b = t1.pageY - t2.pageY\n      const nextDistance = Math.sqrt(a * a + b * b)\n\n      if (this.distance > nextDistance) {\n        this.dollyCurr -= this.dollyStep\n      } else {\n        this.dollyCurr += this.dollyStep\n      }\n\n      this.camera.dolly(this.dollyCurr)\n      this.distance = nextDistance\n    } else if (this.dragging) {\n      this.lastX = this.x\n      this.lastY = this.y\n\n      this.x = t1.pageX\n      this.y = t1.pageY\n\n      const dx = this.lastX - this.x\n      const dy = this.lastY - this.y\n\n      this.rotate(dx, dy)\n    }\n  }\n\n  onMouseWheel = (e: WheelEvent) => {\n    e.stopPropagation()\n    e.preventDefault()\n\n    this.dolly(e.deltaY)\n  }\n\n  dolly(value: number) {\n    if (value < 0) {\n      this.dollyCurr += this.dollyStep\n    } else {\n      this.dollyCurr -= this.dollyStep\n    }\n\n    this.camera.dolly(this.dollyCurr)\n  }\n\n  rotate(dx: number, dy: number) {\n    const { width, height } = this.element\n\n    const incX = (dx / width) * this.rotationSpeed\n    const incY = (dy / height) * this.rotationSpeed\n\n    dx && this.camera.incRotationY(incX)\n    dy && this.camera.incRotationX(incY)\n  }\n}\n"],"file":"OrbitControls.js"}