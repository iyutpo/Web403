{"version":3,"sources":["../../src/OrbitCamera.ts"],"names":["vec3","vec4","mat4","throttle","OrbitCamera","fov","aspect","near","far","projection","view","matrix","position","create","up","right","normal","userRotate","userRotateX","userRotateY","userDolly","rotX","rotY","steps","listeners","invert","radians","Math","PI","perspective","delta","next","step","setPosition","update","set","transformMat4","copy","func","wait","listener","push","id","index","findIndex","d","splice","clone","identity","rotateX","rotateY","translate","upRightNormal","forEach","item"],"mappings":"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","sourcesContent":["import { vec3, vec4, mat4 } from 'gl-matrix'\nimport throttle from 'lodash.throttle'\n\ntype CameraListener = (c: OrbitCamera) => void\n\ntype ListenerItem = {\n  listener: CameraListener\n  id: CameraListener\n}\n\nexport class OrbitCamera {\n  projection: mat4\n  view: mat4\n  matrix: mat4\n\n  constructor(\n    fov: number,\n    aspect: number,\n    near: number = 1,\n    far: number = 1000,\n  ) {\n    this.matrix = mat4.create()\n\n    this.view = mat4.create()\n    mat4.invert(this.view, this.matrix)\n\n    const radians = (fov * Math.PI) / 180.0\n\n    this.projection = mat4.create()\n    mat4.perspective(this.projection, radians, aspect, near, far)\n  }\n\n  position = vec3.create()\n\n  up = vec3.create()\n  right = vec3.create()\n  normal = vec3.create()\n\n  userRotate = true\n  userRotateX = true\n  userRotateY = true\n\n  userDolly = true\n\n  rotX = 0\n  rotY = 0\n\n  steps = 0\n\n  listeners: ListenerItem[] = []\n\n  setProjection(\n    fov: number,\n    aspect: number,\n    near: number = 1,\n    far: number = 1000,\n  ) {\n    const radians = (fov * Math.PI) / 180.0\n    mat4.perspective(this.projection, radians, aspect, near, far)\n  }\n\n  dolly(delta: number) {\n    if (this.userDolly) {\n      const next = vec3.create()\n      const step = delta - this.steps\n\n      next[0] = this.position[0]\n      next[1] = this.position[1]\n      next[2] = this.position[2] - step\n\n      this.steps = delta\n      this.setPosition(next)\n    }\n  }\n\n  setPosition(position: vec3) {\n    this.position[0] = position[0] || 0\n    this.position[1] = position[1] || 0\n    this.position[2] = position[2] || 0\n\n    this.update()\n  }\n\n  upRightNormal() {\n    const up = vec4.create()\n    vec4.set(up, 0, 1, 0, 0)\n    vec4.transformMat4(up, up, this.matrix)\n    vec3.copy(this.up, up as vec3)\n\n    const right = vec4.create()\n    vec4.set(right, 1, 0, 0, 0)\n    vec4.transformMat4(right, right, this.matrix)\n    vec3.copy(this.right, right as vec3)\n\n    const normal = vec4.create()\n    vec4.set(normal, 0, 0, 1, 0)\n    vec4.transformMat4(normal, normal, this.matrix)\n    vec3.copy(this.normal, normal as vec3)\n  }\n\n  setRotationX(rotX: number) {\n    this.rotX = rotX\n\n    if (this.rotX > 360 || this.rotX < -360) {\n      this.rotX = this.rotX % 360\n    }\n\n    this.update()\n  }\n\n  incRotationX(rotX: number) {\n    if (this.userRotate && this.userRotateX) {\n      this.rotX += rotX\n\n      if (this.rotX > 360 || this.rotX < -360) {\n        this.rotX = this.rotX % 360\n      }\n\n      this.update()\n    }\n  }\n\n  setRotationY(rotY: number) {\n    this.rotY = rotY\n\n    if (this.rotY > 360 || this.rotY < -360) {\n      this.rotY = this.rotY % 360\n    }\n\n    this.update()\n  }\n\n  incRotationY(rotY: number) {\n    if (this.userRotate && this.userRotateY) {\n      this.rotY += rotY\n\n      if (this.rotY > 360 || this.rotY < -360) {\n        this.rotY = this.rotY % 360\n      }\n\n      this.update()\n    }\n  }\n\n  addListener(func: CameraListener, wait = 16) {\n    const listener = throttle(func, wait)\n    this.listeners.push({ listener, id: func })\n  }\n\n  removeListener(func: CameraListener) {\n    const index = this.listeners.findIndex(d => {\n      return d.id === func\n    })\n\n    if (index !== -1) {\n      this.listeners.splice(index, 1)\n    }\n  }\n\n  exportView() {\n    return mat4.clone(this.view)\n  }\n\n  update() {\n    mat4.identity(this.matrix)\n\n    mat4.rotateX(this.matrix, this.matrix, (this.rotX * Math.PI) / 180)\n    mat4.rotateY(this.matrix, this.matrix, (this.rotY * Math.PI) / 180)\n    mat4.translate(this.matrix, this.matrix, this.position)\n\n    mat4.invert(this.view, this.matrix)\n\n    this.upRightNormal()\n\n    this.listeners.forEach(item => {\n      item.listener(this)\n    })\n  }\n}\n"],"file":"OrbitCamera.js"}