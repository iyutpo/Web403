{"version":3,"sources":["../../../src/hooks/uniforms.ts"],"names":["useMemo","useEffect","useSceneNode","useUniformSampler2d","gl","program","name","texture","scene","unit","getTextureUnit","memoized","location","getUniformLocation","uniform1i","releaseTextureUnit","useMatrixUniform","value","type","useProgram","useUniformMatrix2fv","useUniformMatrix3fv","useUniformMatrix4fv","useNumberUniform","useUniform1f","useUniform1i","useVectorUniform","useUniform1fv","useUniform1iv","useUniform2fv","useUniform2iv","useUniform3fv","useUniform3iv","useUniform4fv","useUniform4iv"],"mappings":"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","sourcesContent":["import { mat2, mat3, mat4 } from 'gl-matrix'\nimport { useMemo, useEffect } from 'react'\nimport { useSceneNode } from '..'\n\nimport { GLContext } from '../types'\n\nexport function useUniformSampler2d(\n  gl: GLContext,\n  program: WebGLProgram,\n  name: string,\n  texture: WebGLTexture | null,\n) {\n  const scene = useSceneNode()\n\n  const unit = useMemo(() => {\n    return scene.getTextureUnit(texture)\n  }, [scene, texture])\n\n  const memoized = useMemo(() => {\n    const location = gl.getUniformLocation(program, name)\n    gl.uniform1i(location, unit)\n\n    return location\n  }, [gl, program, name, unit])\n\n  useEffect(() => {\n    return () => scene.releaseTextureUnit(unit)\n  }, [scene, unit])\n\n  return [unit, memoized]\n}\n\n// *************************************************\n// Matrix Uniforms\n// *************************************************\n\ntype MatrixUniformType =\n  | 'uniformMatrix2fv'\n  | 'uniformMatrix3fv'\n  | 'uniformMatrix4fv'\n\nfunction useMatrixUniform(\n  gl: GLContext,\n  program: WebGLProgram,\n  name: string,\n  value: any,\n  type: MatrixUniformType,\n) {\n  const memoized = useMemo(() => {\n    return gl.getUniformLocation(program, name)\n  }, [gl, program, name])\n\n  useEffect(() => {\n    gl.useProgram(program)\n    gl[type](memoized, false, value)\n  }, [gl, program, type, memoized, value])\n\n  return memoized\n}\n\nexport function useUniformMatrix2fv(\n  gl: GLContext,\n  program: WebGLProgram,\n  name: string,\n  value: mat2,\n) {\n  return useMatrixUniform(gl, program, name, value, 'uniformMatrix2fv')\n}\n\nexport function useUniformMatrix3fv(\n  gl: GLContext,\n  program: WebGLProgram,\n  name: string,\n  value: mat3,\n) {\n  return useMatrixUniform(gl, program, name, value, 'uniformMatrix3fv')\n}\n\nexport function useUniformMatrix4fv(\n  gl: GLContext,\n  program: WebGLProgram,\n  name: string,\n  value: mat4,\n) {\n  return useMatrixUniform(gl, program, name, value, 'uniformMatrix4fv')\n}\n\n// *************************************************\n// Number Uniforms\n// *************************************************\n\ntype NumberUniformType = 'uniform1f' | 'uniform1i'\n\nfunction useNumberUniform(\n  gl: GLContext,\n  program: WebGLProgram,\n  name: string,\n  value: any,\n  type: NumberUniformType,\n) {\n  const memoized = useMemo(() => {\n    return gl.getUniformLocation(program, name)\n  }, [gl, program, name])\n\n  useEffect(() => {\n    gl.useProgram(program)\n    gl[type](memoized, value)\n  }, [gl, program, type, memoized, value])\n\n  return memoized\n}\n\nexport function useUniform1f(\n  gl: GLContext,\n  program: WebGLProgram,\n  name: string,\n  value: number,\n) {\n  return useNumberUniform(gl, program, name, value, 'uniform1f')\n}\n\nexport function useUniform1i(\n  gl: GLContext,\n  program: WebGLProgram,\n  name: string,\n  value: number,\n) {\n  return useNumberUniform(gl, program, name, value, 'uniform1i')\n}\n\n// *************************************************\n// Vector Uniforms\n// *************************************************\n\ntype VectorUniformType =\n  | 'uniform1fv'\n  | 'uniform1iv'\n  | 'uniform2fv'\n  | 'uniform2iv'\n  | 'uniform3fv'\n  | 'uniform3iv'\n  | 'uniform4fv'\n  | 'uniform4iv'\n\nfunction useVectorUniform(\n  gl: GLContext,\n  program: WebGLProgram,\n  name: string,\n  value: number[],\n  type: VectorUniformType,\n) {\n  const memoized = useMemo(() => {\n    return gl.getUniformLocation(program, name)\n  }, [gl, program, name])\n\n  useEffect(() => {\n    gl.useProgram(program)\n    gl[type](memoized, value)\n  }, [gl, program, type, memoized, value])\n\n  return memoized\n}\n\nexport function useUniform1fv(\n  gl: GLContext,\n  program: WebGLProgram,\n  name: string,\n  value: number[],\n) {\n  return useVectorUniform(gl, program, name, value, 'uniform1fv')\n}\n\nexport function useUniform1iv(\n  gl: GLContext,\n  program: WebGLProgram,\n  name: string,\n  value: number[],\n) {\n  return useVectorUniform(gl, program, name, value, 'uniform1iv')\n}\n\nexport function useUniform2fv(\n  gl: GLContext,\n  program: WebGLProgram,\n  name: string,\n  value: number[],\n) {\n  return useVectorUniform(gl, program, name, value, 'uniform2fv')\n}\n\nexport function useUniform2iv(\n  gl: GLContext,\n  program: WebGLProgram,\n  name: string,\n  value: number[],\n) {\n  return useVectorUniform(gl, program, name, value, 'uniform2iv')\n}\n\nexport function useUniform3fv(\n  gl: GLContext,\n  program: WebGLProgram,\n  name: string,\n  value: number[],\n) {\n  return useVectorUniform(gl, program, name, value, 'uniform3fv')\n}\n\nexport function useUniform3iv(\n  gl: GLContext,\n  program: WebGLProgram,\n  name: string,\n  value: number[],\n) {\n  return useVectorUniform(gl, program, name, value, 'uniform3iv')\n}\n\nexport function useUniform4fv(\n  gl: GLContext,\n  program: WebGLProgram,\n  name: string,\n  value: number[],\n) {\n  return useVectorUniform(gl, program, name, value, 'uniform4fv')\n}\n\nexport function useUniform4iv(\n  gl: GLContext,\n  program: WebGLProgram,\n  name: string,\n  value: number[],\n) {\n  return useVectorUniform(gl, program, name, value, 'uniform4iv')\n}\n"],"file":"uniforms.js"}