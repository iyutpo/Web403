"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.usePointLight = usePointLight;
exports.usePointLightUniforms = usePointLightUniforms;
exports.usePointLightCount = usePointLightCount;

var _react = require("react");

var _Context = _interopRequireDefault(require("../Context"));

var _ = require("..");

var white = [1, 1, 1];
var origin = [0, 0, 0];

function usePointLight() {
  var color = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : white;
  var position = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : origin;
  var context = (0, _react.useContext)(_Context["default"]);

  if (!context) {
    throw new Error("usePointLight ".concat(_.ctxErr));
  }

  var pointLights = (0, _react.useMemo)(function () {
    if (!context.scene) {
      throw Error('The scene is not on the context.');
    }

    return context.scene.pointLights;
  }, [context]);
  var light = (0, _react.useMemo)(function () {
    return pointLights.add();
  }, [pointLights]);
  (0, _react.useEffect)(function () {
    pointLights.updateDiffuse(light, color);
  }, [pointLights, light, color]);
  (0, _react.useEffect)(function () {
    pointLights.updatePosition(light, position);
  }, [pointLights, light, position]);
  (0, _react.useEffect)(function () {
    return function () {
      return pointLights.remove(light);
    };
  }, [pointLights, light]);
}

function usePointLightUniforms(gl, program) {
  var context = (0, _react.useContext)(_Context["default"]);

  if (!context) {
    throw new Error("usePointLightUniforms ".concat(_.ctxErr));
  }

  if (!context.scene) {
    throw Error('The scene is not on the context.');
  }

  (0, _.useUniform3fv)(gl, program, 'pointLd', context.scene.pointLights.diffuse);
  (0, _.useUniform3fv)(gl, program, 'pointLp', context.scene.pointLights.position);
}

function usePointLightCount(vertSource, fragSource) {
  var context = (0, _react.useContext)(_Context["default"]);

  if (!context) {
    throw new Error("usePointLightCount ".concat(_.ctxErr));
  }

  if (!context.scene) {
    throw Error('The scene is not on the context.');
  }

  var memoizedVert = (0, _react.useMemo)(function () {
    if (!context.scene) {
      throw Error('The scene is not on the context.');
    }

    var count = context.scene.pointLights.instances.length;
    return vertSource.replace('<<NUM_POINT_LIGHTS>>', "".concat(count));
  }, [vertSource, context.scene.pointLights.instances.length]);
  var memoizedFrag = (0, _react.useMemo)(function () {
    if (!context.scene) {
      throw Error('The scene is not on the context.');
    }

    var count = context.scene.pointLights.instances.length;
    return fragSource.replace('<<NUM_POINT_LIGHTS>>', "".concat(count));
  }, [fragSource, context.scene.pointLights.instances.length]);
  return [memoizedVert, memoizedFrag];
}
//# sourceMappingURL=lights.js.map